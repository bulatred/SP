**ЛОГИЧЕСКАЯ БАЗА ДАННЫХ**

┌─────────────────────────────────────────────────────┐
│                     ПОЛЬЗОВАТЕЛЬ                    │
│                  (USER / users)                     │
├─────────────────────────────────────────────────────┤
│ PK | id                (уникальный идентификатор)    │
│    | username          (логин, уникальный)           │
│    | password          (хэш пароля bcrypt)           │
│    | role              (ROLE_ADMIN / ROLE_USER)      │
│    | enabled           (активен ли аккаунт)          │
└──────────────────────────┬───────────────────────────┘
                           │
                           │ 1:М (один ко многим)
                           │ Пользователь имеет доступ
                           │ к данным датчиков
                           ↓
┌─────────────────────────────────────────────────────┐
│                    АВТОБУС                          │
│                  (BUS / buses)                      │
├─────────────────────────────────────────────────────┤
│ PK | id                (уникальный идентификатор)    │
│    | model             (модель автобуса)             │
│    | photo_url         (путь к фото)                 │
└──────────────────────────┬───────────────────────────┘
                           │
                           │ 1:М (один ко многим)
                           │ Автобус генерирует данные
                           ↓
┌─────────────────────────────────────────────────────┐
│                ДАННЫЕ ДАТЧИКОВ                      │
│              (SENSOR_DATA / sensor_data)            │
├─────────────────────────────────────────────────────┤
│ PK | id                (уникальный идентификатор)    │
│ FK | bus_id            (ссылка на автобус) → buses.id│
│    | sensor_type       (тип датчика):                │
│    |                   - ENGINE_TEMP                 │
│    |                   - FUEL_LEVEL                  │
│    |                   - TIRE_PRESSURE               │
│    | value             (числовое значение)           │
│    | timestamp         (время замера)                │
│    | anomaly           (флаг аномалии: true/false)   │
└─────────────────────────────────────────────────────┘

                 ▲
                 │
                 │ М:1 (многие к одному)
                 │ Данные принадлежат автобусу
                 └─────────────────────────────────┘

**ФИЗИЧЕСКАЯ БАЗА ДАННЫХ**

┌─────────────────────────────────────────────────────────────────┐
│                           users                                 │
├──────────┬─────────────────────────┬─────────────┬──────────────┤
│ Название │ Тип данных              │ Ограничения │ Описание     │
├──────────┼─────────────────────────┼─────────────┼──────────────┤
│ id       │ BIGSERIAL               │ PRIMARY KEY │ Уникальный ID│
│ username │ VARCHAR(255)            │ UNIQUE      │ Логин        │
│          │                         │ NOT NULL    │              │
│ password │ VARCHAR(255)            │ NOT NULL    │ Хэш пароля   │
│ role     │ VARCHAR(50)             │ NOT NULL    │ Роль         │
│ enabled  │ BOOLEAN                 │ DEFAULT true│ Активен      │
└──────────┴─────────────────────────┴─────────────┴──────────────┘

ИНДЕКСЫ:
- PRIMARY KEY: id
- UNIQUE: username
- INDEX: role (для фильтрации по роли)

┌─────────────────────────────────────────────────────────────────┐
│                           buses                                 │
├──────────┬─────────────────────────┬─────────────┬──────────────┤
│ Название │ Тип данных              │ Ограничения │ Описание     │
├──────────┼─────────────────────────┼─────────────┼──────────────┤
│ id       │ BIGSERIAL               │ PRIMARY KEY │ Уникальный ID│
│ model    │ VARCHAR(255)            │ NOT NULL    │ Модель       │
│ photo_url│ VARCHAR(512)            │             │ Путь к фото  │
└──────────┴─────────────────────────┴─────────────┴──────────────┘

ИНДЕКСЫ:
- PRIMARY KEY: id
- INDEX: model (для поиска по модели)

┌─────────────────────────────────────────────────────────────────┐
│                        sensor_data                              │
├──────────┬─────────────────────────┬─────────────┬──────────────┤
│ Название │ Тип данных              │ Ограничения │ Описание     │
├──────────┼─────────────────────────┼─────────────┼──────────────┤
│ id       │ BIGSERIAL               │ PRIMARY KEY │ Уникальный ID│
│ bus_id   │ BIGINT                  │ NOT NULL    │ FK → buses.id│
│          │                         │ FOREIGN KEY │              │
│          │                         │ ON DELETE   │              │
│          │                         │ CASCADE     │              │
│ sensor_  │ VARCHAR(50)             │ NOT NULL    │ Тип датчика  │
│ type     │                         │             │              │
│ value    │ DOUBLE PRECISION        │ NOT NULL    │ Значение     │
│ timestamp│ TIMESTAMP               │ NOT NULL    │ Время замера │
│ anomaly  │ BOOLEAN                 │ NOT NULL    │ Аномалия     │
└──────────┴─────────────────────────┴─────────────┴──────────────┘

ИНДЕКСЫ:
- PRIMARY KEY: id
- FOREIGN KEY: bus_id → buses.id
- INDEX: bus_id (для JOIN операций)
- INDEX: sensor_type (для фильтрации по типу)
- INDEX: timestamp (для временных запросов)
- INDEX: anomaly (для поиска аномалий)
- COMPOSITE INDEX: (bus_id, timestamp DESC) - для истории по автобусу

    ┌─────────┐         ┌─────────┐         ┌───────────────┐
    │  users  │         │  buses  │         │ sensor_data   │
    ├─────────┤         ├─────────┤         ├───────────────┤
    │ id (PK) │         │ id (PK) │◄────────┤ bus_id (FK)   │
    │ username│         │ model   │         │ sensor_type   │
    │ password│         │photo_url│         │ value         │
    │ role    │         └─────────┘         │ timestamp     │
    │ enabled │              1               │ anomaly       │
    └─────────┘              │               └───────────────┘
         │                   │                      M
         │                   │                      │
         │                   │                      │
         └───────────────────┼──────────────────────┘
                (доступ)     │            (генерирует)
                             M

